<link rel="stylesheet" href="/css/app.css">
<link rel="stylesheet" href="/css/cart.css">
{{>header}}

<script>
    productList = []
</script>

<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Giỏ hàng</h5>
    </div>
    <div class="modal-body">
        <table id="table" class="table">
            <thead class="thead-dark">
                <tr>
                <th scope="col">#</th>
                <th scope="col">Tên mặt hàng</th>
                <th scope="col">Số lượng</th>
                <th scope="col">Đơn giá</th>
                <th scope="col">Thành tiền</th>
                </tr>
            </thead>
            <tbody id="myTable">
                

                {{#each products}}
                    
                    <tr>
                    <th scope="row">1</th>
                    <td>{{this.name}}</td>
                    <td>{{lookup ../orderInfo this._id }}</td>
                    <td>{{this.price}}</td>
                    <td class="sumPrice">{{_mul (lookup ../orderInfo this._id) this.price}}</td>
                    </tr>

                    <script>
                
                        productList.push({
                            id: '{{this._id}}',
                            quantity: '{{lookup ../orderInfo this._id }}',
                        })

                        console.log(productList)

                    </script>

                {{/each}}
            </tbody>
        </table>

        <div style="text-align: center;">
            <h4 id="totalPrice">Tổng số tiền: 0</h4>
            <div class="row justify-content-center">
                <label for="inputPassword" class="col-sm-2 col-form-label">Số điện thoại</label>
                <div class="col-sm-3">
                    <form style="position: relative;" id="orderForm" method="POST" action="/admin/banhang/kiemtravip">
                        <input style="width: 150px;" type="text" class="form-control" id="phoneNumInput" name="phoneNumber">
                        <button style="position: absolute; top: 0; right: -120px;" type="submit" class="btn btn-info" id="makePaymentButton" form="orderForm">Kiểm tra SĐT</button>
                    </form>
                </div>
            </div>
        </div>
    
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-success" id="makePaymentButton" form="orderForm">Thanh toán</button>
    </div>
    </div>
</div>

<script>
    
    let totalPrice = 0;
    const sumPriceList = document.getElementsByClassName("sumPrice")
    const totalPriceH4 = document.getElementById("totalPrice")
    const makePaymentBtn = document.getElementById("makePaymentButton")
    const orderFormData = document.getElementById("orderForm")
    
    for(let i = 0 ; i < sumPriceList.length ; i++) {
        totalPrice += parseInt(sumPriceList[i].textContent)
    }
    
    totalPriceH4.innerHTML = `Tổng số tiền: ${totalPrice}`

    makePaymentBtn.addEventListener("click", function() {
        for(let i = 0 ; i < productList.length ; i++) {
            const input = `<input type="hidden" name="${productList[i].id}" value="${productList[i].quantity}">`
            orderFormData.innerHTML += input
        }

        orderFormData.submit()
    })

</script>


{{!-- <div class="container-fluid my-4" style="width: 80%">
    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th style="width: 17%; text-align: center;">Sản phẩm</th>
                <th style="width: 25%"></th>
                <th style="width: 21%; text-align: center;">Số lượng</th>
                <th style="width: 14%; text-align: center;">Đơn giá</th>
                <th style="width: 15%; text-align: center;">Thành tiền</th>
                <th style="width: 8%"></th>
                
            </tr>
        </thead>
        <tbody>
            <tr>
                <th scope="row">
                    <a class="thumbnail pull-left" href="#"> <img class="media-object" src="http://icons.iconarchive.com/icons/custom-icon-design/flatastic-2/72/product-icon.png" style="width: 80%"> </a>
                </th>
                <td>
                    <h3>Áo</h3>
                    <p>Size: L</p>
                </td>
                <td style="text-align: center;">
                    <div class="number-input" style="width: 80%;">
                        <button onclick="this.parentNode.querySelector('input[type=number]').stepDown()" ></button>
                        <input class="quantity" min="1" name="quantity" value="1" type="number" disabled>
                        <button onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
                    </div>
                <td style="text-align: center;">@mdo</td>
                <td style="text-align: center;">@mdo</td>
                <td>
                    <a href="">
                        <span class="badge badge-danger">
                            <i class="ti-trash" style="font-size: 20px;"></i>
                        </span>
                    </a>
                </td>
            </tr>
            
        <tr>
            <td>   </td>
            <td>   </td>
            <td>   </td>
            <td><h3>Tổng</h3></td>
            <td class="text-right"><h3><strong>$31.53</strong></h3></td>
        </tr>
        <tr>
            <td>   </td>
            <td>   </td>
            <td>   </td>
            <td><h5>Số điện thoại</h5></td>
            <td class="text-right">
              <input type="text">
            </td>
        </tr>
        <tr>
            <td>   </td>
            <td>   </td>
            <td>   </td>
            <td>
            <button type="button" class="btn btn-secondary">
                Tiếp tục mua sắm
            </button></td>
            <td>
            <button type="button" class="btn btn-danger">
                Thanh toán 
            </button></td>
        </tr>
        </tbody>
    </table>
</div>

<script>

</script> --}}
<!--
<div class="head">GIỎ HÀNG</div>
<div class="container-fluid giohang">
    <table class="table">
        <thead>
          <tr>
            <th scope="col">STT</th>
            <th scope="col">Mặt hàng</th>
            <th scope="col">Số lượng</th>
            <th scope="col">Đơn giá</th>
            <th scope="col">Thành tiền</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th scope="row">2</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th scope="row">3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
</div>
<div class=" row nhapsdt">
  <div class="col col-half mt-50 sdt">Số điện thoại</div>
  <div class="col col-half mt-50">
    <input type="text">
  </div>
</div>
<div class="row tongsotien">
  <div class="col col-half mt-50 sotien">Tổng số tiền:</div>
  <div class="col col-half"></div>
</div>
<div class="row">
  <div class="col col-half">
    <input class="mt-50 huythanhtoan" type="submit" value="HỦY THANH TOÁN">
  </div>
  <div class="col col-half">
    <input class="mt-50 thanhtoan" type="submit" value="THANH TOÁN">
  </div>
</div>  
-->
{{>footer}}